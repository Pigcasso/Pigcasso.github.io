<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta property="og:type" content="website">
<meta property="og:title" content="Now Or Never!!">
<meta property="og:url" content="http://zhuliang.io/page/2/index.html">
<meta property="og:site_name" content="Now Or Never!!">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Now Or Never!!">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://zhuliang.io/page/2/"/>





  <title>Now Or Never!!</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Now Or Never!!</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhuliang.io/2018/03/23/summarize-checked-text-view/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhu Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Now Or Never!!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/23/summarize-checked-text-view/" itemprop="url">CheckedTextView知识点整理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-23T00:00:00+08:00">
                2018-03-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="为CheckedTextView-设置文字、图标、背景"><a href="#为CheckedTextView-设置文字、图标、背景" class="headerlink" title="为CheckedTextView 设置文字、图标、背景"></a>为CheckedTextView 设置文字、图标、背景</h1><p>效果如下：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fpm25bx0jfg302w030q36.gif" alt=""></p>
<h2 id="图标"><a href="#图标" class="headerlink" title="图标"></a>图标</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--drawable/ic_search_24dp.xml--&gt;</span></span><br><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_checked</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer-list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:width</span>=<span class="string">"24dp"</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">android:height</span>=<span class="string">"24dp"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bitmap</span> <span class="attr">android:src</span>=<span class="string">"@drawable/ic_search_white"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:tint</span>=<span class="string">"@color/litra_dark_gray"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_checked</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer-list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:width</span>=<span class="string">"24dp"</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">android:height</span>=<span class="string">"24dp"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bitmap</span> <span class="attr">android:src</span>=<span class="string">"@drawable/ic_search_white"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:tint</span>=<span class="string">"@color/litra_golden"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="文字的颜色"><a href="#文字的颜色" class="headerlink" title="文字的颜色"></a>文字的颜色</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--color/checked_text_color.xml--&gt;</span></span><br><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">"@color/litra_dark_gray"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:state_checked</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">"@color/litra_golden"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:state_checked</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--drawable/bg_checked_text.xml--&gt;</span></span><br><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_checked</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">shape</span> <span class="attr">android:shape</span>=<span class="string">"rectangle"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">stroke</span> <span class="attr">android:width</span>=<span class="string">"1dp"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">android:color</span>=<span class="string">"@color/litra_dark_gray"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">"4dp"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_checked</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">shape</span> <span class="attr">android:shape</span>=<span class="string">"rectangle"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">stroke</span> <span class="attr">android:width</span>=<span class="string">"1dp"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">android:color</span>=<span class="string">"@color/litra_golden"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">"4dp"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="为CheckedTextView设置图标、文字颜色、背景"><a href="#为CheckedTextView设置图标、文字颜色、背景" class="headerlink" title="为CheckedTextView设置图标、文字颜色、背景"></a>为CheckedTextView设置图标、文字颜色、背景</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">CheckedTextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/checkedTextView"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"@drawable/bg_checked_text"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:checked</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawableTop</span>=<span class="string">"@drawable/ic_search_24dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">"center_horizontal"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"Strobe"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">"@color/checked_text_color"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>设置<code>android:checked=&quot;true&quot;</code>,<code>android:checked=&quot;false&quot;</code>后的样式分别为：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fpm22a2mj9j303o03mgli.jpg" alt=""><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fpm23lxgkij303m03m0sl.jpg" alt=""></p>
<h2 id="代码中切换状态"><a href="#代码中切换状态" class="headerlink" title="代码中切换状态"></a>代码中切换状态</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> CheckedTextView checkedTextView = view.findViewById(R.id.checkedTextView);</span><br><span class="line">checkedTextView.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        checkedTextView.toggle();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhuliang.io/2018/03/22/summarize-rotate-imageview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhu Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Now Or Never!!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/22/summarize-rotate-imageview/" itemprop="url">旋转ImageView的几种方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-22T10:13:00+08:00">
                2018-03-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>content<br>{:toc}</li>
</ul>
<h1 id="通过Matrix旋转ImageView"><a href="#通过Matrix旋转ImageView" class="headerlink" title="通过Matrix旋转ImageView"></a>通过Matrix旋转ImageView</h1><h2 id="关键代码"><a href="#关键代码" class="headerlink" title="关键代码"></a>关键代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Matrix matrix = <span class="keyword">new</span> Matrix();</span><br><span class="line">matrix.postTranslate((mImageWidth - mBitmapWidth) / <span class="number">2</span>, (mImageHeight - mBitmapHeight) / <span class="number">2</span>);</span><br><span class="line">matrix.postScale(scale, scale, mImageWidth / <span class="number">2</span>, mImageHeight / <span class="number">2</span>);</span><br><span class="line">mImageView.setImageMatrix(matrix);</span><br></pre></td></tr></table></figure>
<p>关于Matrix，请参考：<a href="https://www.jianshu.com/p/6aa6080373ab" target="_blank" rel="noopener">深入理解 Android 中的 Matrix</a></p>
<h1 id="通过Rotation属性旋转ImageView"><a href="#通过Rotation属性旋转ImageView" class="headerlink" title="通过Rotation属性旋转ImageView"></a>通过Rotation属性旋转ImageView</h1><h2 id="关键代码-1"><a href="#关键代码-1" class="headerlink" title="关键代码"></a>关键代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mImageView.setRotation(degrees);</span><br></pre></td></tr></table></figure>
<h1 id="通过旋转Bitmap旋转ImageView"><a href="#通过旋转Bitmap旋转ImageView" class="headerlink" title="通过旋转Bitmap旋转ImageView"></a>通过旋转Bitmap旋转ImageView</h1><h2 id="关键代码-2"><a href="#关键代码-2" class="headerlink" title="关键代码"></a>关键代码</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 按照指定的角度旋转Bitmap，并返回结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">rotatedBitmap</span><span class="params">(source: <span class="type">Bitmap</span>, degrees: <span class="type">Float</span>)</span></span>: Bitmap &#123;</span><br><span class="line">    <span class="keyword">val</span> bitmapW = source.width</span><br><span class="line">    <span class="keyword">val</span> bitmapH = source.height</span><br><span class="line">    <span class="keyword">val</span> matrix = Matrix()</span><br><span class="line">    matrix.postRotate(degrees)</span><br><span class="line">    <span class="keyword">return</span> Bitmap.createBitmap(source, <span class="number">0</span>, <span class="number">0</span>, bitmapW, bitmapH, matrix, <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhuliang.io/2018/03/21/summarize-markdown-syntax/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhu Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Now Or Never!!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/21/summarize-markdown-syntax/" itemprop="url">Markdown语法整理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-21T00:00:00+08:00">
                2018-03-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Markdown/" itemprop="url" rel="index">
                    <span itemprop="name">Markdown</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>content<br>{:toc}</li>
</ul>
<h1 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h1><p>设置图片的宽度、高度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![Octocat](https://assets-cdn.github.com/images/modules/logos_page/Octocat.png)&#123;: height=&quot;133px&quot; width=&quot;160px&quot;&#125;</span><br></pre></td></tr></table></figure></p>
<p>效果如下：<br><img src="https://assets-cdn.github.com/images/modules/logos_page/Octocat.png" alt="Octocat">{: height=”133px” width=”160px”}</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhuliang.io/2018/03/18/summarize-photo-picker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhu Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Now Or Never!!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/18/summarize-photo-picker/" itemprop="url">图片选择器知识点总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-18T00:00:00+08:00">
                2018-03-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>content<br>{:toc}</li>
</ul>
<h1 id="为什么要自己写？"><a href="#为什么要自己写？" class="headerlink" title="为什么要自己写？"></a>为什么要自己写？</h1><p>问：图片选择器的开源库这么多，为什么要自己写？<br>答：图片选择器的开源库确实很多，比如：<a href="https://github.com/donglua/PhotoPicker" title="PhotoPicker" target="_blank" rel="noopener">PhotoPicker</a>、<a href="https://github.com/zhihu/Matisse" target="_blank" rel="noopener">Matisse</a>、<a href="https://github.com/Werb/PickPhotoSample" target="_blank" rel="noopener">PickPhotoSample</a>、<a href="https://github.com/yanzhenjie/Album" title="Album" target="_blank" rel="noopener">Album</a>、<a href="https://github.com/FinalTeam/RxGalleryFinal" target="_blank" rel="noopener">RxGalleryFinal</a>，自己写的唯一原因就是没有找到支持全选图片功能的开源库。</p>
<h2 id="图片选择器鉴赏"><a href="#图片选择器鉴赏" class="headerlink" title="图片选择器鉴赏"></a>图片选择器鉴赏</h2><p>Matisse</p>
<p><img src="https://raw.githubusercontent.com/zhihu/Matisse/master/image/screenshot_zhihu.png" alt="">{:width=”200px”}<img src="https://raw.githubusercontent.com/zhihu/Matisse/master/image/screenshot_dracula.png" alt="">{:width=”200px”}<img src="https://raw.githubusercontent.com/zhihu/Matisse/master/image/screenshot_preview.png" alt="">{:width=”200px”}</p>
<p>PickPhotoSample</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fpegcrquefj30og17laef.jpg" alt="">{:width=”200px”}<img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fpegdaqmqij30o617fgn5.jpg" alt="">{:width=”200px”}<img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fpegdaqmqij30o617fgn5.jpg" alt="">{:width=”200px”}<img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fpegdsv6c8j30o0178jvl.jpg" alt="">{:width=”200px”}</p>
<p>Album</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fpeh8itfg7j308f0f1tad.jpg" alt="">{:width=”200px”}</p>
<h1 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h1><h1 id="开发知识点整理"><a href="#开发知识点整理" class="headerlink" title="开发知识点整理"></a>开发知识点整理</h1><h2 id="占位符"><a href="#占位符" class="headerlink" title="占位符"></a>占位符</h2><p>正在加载图片占位符<br>加载图片失败占位符</p>
<h2 id="如何获取相册"><a href="#如何获取相册" class="headerlink" title="如何获取相册"></a>如何获取相册</h2><h2 id="支持Activity和Fragment的startActivityForResult"><a href="#支持Activity和Fragment的startActivityForResult" class="headerlink" title="支持Activity和Fragment的startActivityForResult()"></a>支持Activity和Fragment的startActivityForResult()</h2><h2 id="Permissions"><a href="#Permissions" class="headerlink" title="Permissions"></a>Permissions</h2><p>需要请求读取外部存储的权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Manifest.permission.READ_EXTERNAL_STORAGE</span><br></pre></td></tr></table></figure>
<h3 id="引入依赖库"><a href="#引入依赖库" class="headerlink" title="引入依赖库"></a>引入依赖库</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation <span class="string">"pub.devrel:easypermissions:$rootProject.ext.easypermissionsVersion"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Kotlin语法"><a href="#Kotlin语法" class="headerlink" title="Kotlin语法"></a>Kotlin语法</h2><p>忽略强制转换警告：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Suppress(<span class="meta-string">"UNCHECKED_CAST"</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">foo</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> a: Any = <span class="string">"word"</span></span><br><span class="line">    <span class="keyword">var</span> b: String</span><br><span class="line">    b = a <span class="keyword">as</span> String</span><br><span class="line">    println(b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="角标显示用户选择照片的次序"><a href="#角标显示用户选择照片的次序" class="headerlink" title="角标显示用户选择照片的次序"></a>角标显示用户选择照片的次序</h2><h2 id="自定义图片加载器"><a href="#自定义图片加载器" class="headerlink" title="自定义图片加载器"></a>自定义图片加载器</h2><p>读这几个图片选择器源码，了解这几个项目如何不直接引用开源图片加载框架。</p>
<h3 id="RxGalleryFinal的实现方式"><a href="#RxGalleryFinal的实现方式" class="headerlink" title="RxGalleryFinal的实现方式"></a><a href="https://github.com/FinalTeam/RxGalleryFinal" target="_blank" rel="noopener">RxGalleryFinal</a>的实现方式</h3><p>build.gradle</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    provided <span class="string">'com.squareup.picasso:picasso:2.5.2'</span></span><br><span class="line">    provided <span class="string">'com.facebook.fresco:fresco:1.3.0'</span></span><br><span class="line">    provided <span class="string">'com.facebook.fresco:animated-gif:1.3.0'</span></span><br><span class="line">    provided <span class="string">'com.github.bumptech.glide:glide:3.7.0'</span></span><br><span class="line">    provided <span class="string">'com.nostra13.universalimageloader:universal-image-loader:1.9.5'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用<code>provided</code>依赖项仅在编译时对模块可用，并且在编译或运行时对其消费者不可用。也就是说你的应用引入<a href="https://github.com/FinalTeam/RxGalleryFinal" target="_blank" rel="noopener">RxGalleryFinal</a>，并不会将这些图片加载框架引入到你的项目。</p>
<p>抽象图片加载器</p>
<p>定义接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AbsImageLoader</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">displayImage</span><span class="params">(Context context,</span></span></span><br><span class="line"><span class="function"><span class="params">                      String path,</span></span></span><br><span class="line"><span class="function"><span class="params">                      FixImageView imageView,</span></span></span><br><span class="line"><span class="function"><span class="params">                      Drawable defaultDrawable,</span></span></span><br><span class="line"><span class="function"><span class="params">                      Bitmap.Config config,</span></span></span><br><span class="line"><span class="function"><span class="params">                      <span class="keyword">boolean</span> resize,</span></span></span><br><span class="line"><span class="function"><span class="params">                      <span class="keyword">boolean</span> isGif,</span></span></span><br><span class="line"><span class="function"><span class="params">                      <span class="keyword">int</span> width,</span></span></span><br><span class="line"><span class="function"><span class="params">                      <span class="keyword">int</span> height,</span></span></span><br><span class="line"><span class="function"><span class="params">                      <span class="keyword">int</span> rotate)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现接口</p>
<p>针对不同的图片加载框架，提供不同的<code>AbsImageLoader</code>实现类：<a href="https://github.com/FinalTeam/RxGalleryFinal/blob/master/library/src/main/java/cn/finalteam/rxgalleryfinal/imageloader/FrescoImageLoader.java" target="_blank" rel="noopener">FrescoImageLoader.java</a>、 <a href="https://github.com/FinalTeam/RxGalleryFinal/blob/master/library/src/main/java/cn/finalteam/rxgalleryfinal/imageloader/GlideImageLoader.java" target="_blank" rel="noopener">GlideImageLoader.java</a>、 <a href="https://github.com/FinalTeam/RxGalleryFinal/blob/master/library/src/main/java/cn/finalteam/rxgalleryfinal/imageloader/PicassoImageLoader.java" target="_blank" rel="noopener">PicassoImageLoader.java</a>、<a href="https://github.com/FinalTeam/RxGalleryFinal/blob/master/library/src/main/java/cn/finalteam/rxgalleryfinal/imageloader/UniversalImageLoader.java" title="UniversalImageLoader.java" target="_blank" rel="noopener">UniversalImageLoader.java</a></p>
<p>选择图片加载器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义方法的单选</span></span><br><span class="line"> RxGalleryFinal</span><br><span class="line"> .with(context)</span><br><span class="line"> .image()</span><br><span class="line"> .radio()</span><br><span class="line"> .crop()</span><br><span class="line"> .imageLoader(ImageLoaderType.GLIDE) <span class="comment">// 选择图片加载器类型</span></span><br><span class="line"> .subscribe(<span class="keyword">new</span> RxBusResultSubscriber&lt;ImageRadioResultEvent&gt;() &#123;</span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(ImageRadioResultEvent imageRadioResultEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">         <span class="comment">//图片选择结果</span></span><br><span class="line">         .....</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;)</span><br><span class="line"> .openGallery();</span><br></pre></td></tr></table></figure>
<h3 id="PhotoPicker的实现方式"><a href="#PhotoPicker的实现方式" class="headerlink" title="PhotoPicker的实现方式"></a><a href="https://github.com/donglua/PhotoPicker" title="PhotoPicker" target="_blank" rel="noopener">PhotoPicker</a>的实现方式</h3><p>这个库就比较简单粗暴了，直接引用了<a href="https://github.com/bumptech/glide" title="Glide" target="_blank" rel="noopener">Glide</a>。</p>
<p>build.gradle</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">"com.github.bumptech.glide:glide:4.1.1"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Matisse-的实现方式"><a href="#Matisse-的实现方式" class="headerlink" title="Matisse 的实现方式"></a>Matisse 的实现方式</h3><p>build.gradle</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compileOnly <span class="string">'com.github.bumptech.glide:glide:3.7.0'</span></span><br><span class="line">	compileOnly <span class="string">'com.squareup.picasso:picasso:2.5.2'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>抽象图片加载器</p>
<p>定义接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ImageEngine</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">loadThumbnail</span><span class="params">(Context context, <span class="keyword">int</span> resize, Drawable placeholder, ImageView imageView, Uri uri)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">loadGifThumbnail</span><span class="params">(Context context, <span class="keyword">int</span> resize, Drawable placeholder, ImageView imageView, Uri uri)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">loadImage</span><span class="params">(Context context, <span class="keyword">int</span> resizeX, <span class="keyword">int</span> resizeY, ImageView imageView, Uri uri)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">loadGifImage</span><span class="params">(Context context, <span class="keyword">int</span> resizeX, <span class="keyword">int</span> resizeY, ImageView imageView, Uri uri)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">supportAnimatedGif</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现接口</p>
<p><a href="https://github.com/zhihu/Matisse" title="Matisse" target="_blank" rel="noopener">Matisse</a>只提供了两个<a href="https://github.com/zhihu/Matisse/blob/master/matisse/src/main/java/com/zhihu/matisse/engine/ImageEngine.java" title="ImageEngine.java" target="_blank" rel="noopener">ImageEngine</a>的实现类：<a href="https://github.com/zhihu/Matisse/blob/master/matisse/src/main/java/com/zhihu/matisse/engine/impl/PicassoEngine.java" title="PicassoEngine.java" target="_blank" rel="noopener">PicassoEngine</a>、<a href="https://github.com/zhihu/Matisse/blob/master/matisse/src/main/java/com/zhihu/matisse/engine/impl/GlideEngine.java" title="GlideEngine.java" target="_blank" rel="noopener">GlideEngine</a>。</p>
<p>选择图片加载器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Matisse.from(MainActivity.<span class="keyword">this</span>)</span><br><span class="line">        .choose(MimeType.allOf())</span><br><span class="line">        .countable(<span class="keyword">true</span>)</span><br><span class="line">        .maxSelectable(<span class="number">9</span>)</span><br><span class="line">        .addFilter(<span class="keyword">new</span> GifSizeFilter(<span class="number">320</span>, <span class="number">320</span>, <span class="number">5</span> * Filter.K * Filter.K))</span><br><span class="line">        .gridExpectedSize(getResources().getDimensionPixelSize(R.dimen.grid_expected_size))</span><br><span class="line">        .restrictOrientation(ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED)</span><br><span class="line">        .thumbnailScale(<span class="number">0.85f</span>)</span><br><span class="line">        .imageEngine(<span class="keyword">new</span> GlideEngine()) <span class="comment">// 选择ImageEngine的实现类</span></span><br><span class="line">        .forResult(REQUEST_CODE_CHOOSE);</span><br></pre></td></tr></table></figure>
<h3 id="PickPhotoSample的实现方式"><a href="#PickPhotoSample的实现方式" class="headerlink" title="PickPhotoSample的实现方式"></a><a href="https://github.com/Werb/PickPhotoSample" title="PickPhotoSample" target="_blank" rel="noopener">PickPhotoSample</a>的实现方式</h3><p>跟<a href="https://github.com/donglua/PhotoPicker" title="PhotoPicker" target="_blank" rel="noopener">PhotoPicker</a>一样，直接引用了<a href="https://github.com/bumptech/glide" title="Glide" target="_blank" rel="noopener">Glide</a>。</p>
<p>build.gradle</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'com.github.bumptech.glide:glide:4.5.0'</span></span><br></pre></td></tr></table></figure>
<h3 id="Album的实现方式"><a href="#Album的实现方式" class="headerlink" title="Album的实现方式"></a><a href="https://github.com/yanzhenjie/Album" title="Album" target="_blank" rel="noopener">Album</a>的实现方式</h3><p>抽象图片加载器</p>
<p>定义接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AlbumLoader</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Load a preview of the album file.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> imageView  &#123;<span class="doctag">@link</span> ImageView&#125;.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> albumFile  the media object may be a picture or video.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> viewWidth  the width fo target view.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> viewHeight the width fo target view.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">loadAlbumFile</span><span class="params">(ImageView imageView, AlbumFile albumFile, <span class="keyword">int</span> viewWidth, <span class="keyword">int</span> viewHeight)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Load a preview of the picture.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> imageView  &#123;<span class="doctag">@link</span> ImageView&#125;.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> imagePath  file path, which may be a local path or a network path.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> viewWidth  the width fo target view.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> viewHeight the width fo target view.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">loadImage</span><span class="params">(ImageView imageView, String imagePath, <span class="keyword">int</span> viewWidth, <span class="keyword">int</span> viewHeight)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>默认实现类：<a href="https://github.com/yanzhenjie/Album/blob/2db5214070189e3dc00348abd221d85a841ce5c2/album/src/main/java/com/yanzhenjie/album/task/DefaultAlbumLoader.java" title="DefaultAlbumLoader.java" target="_blank" rel="noopener">DefaultAlbumLoader.java</a></p>
<p>可以在代码中自行修改<code>AlbumLoader</code>的实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate();</span><br><span class="line"></span><br><span class="line">    Album.initialize(</span><br><span class="line">        AlbumConfig.newBuilder(<span class="keyword">this</span>)</span><br><span class="line">            .setAlbumLoader(<span class="keyword">new</span> GlideAlbumLoader()) <span class="comment">// 设置Album加载器。</span></span><br><span class="line">            .setLocale(Locale.CHINA) <span class="comment">// 比如强制设置在任何语言下都用中文显示。</span></span><br><span class="line">            .build()</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="流式API的写法"><a href="#流式API的写法" class="headerlink" title="流式API的写法"></a>流式API的写法</h3><p>参考 <a href="https://github.com/yanzhenjie/Album" title="Album" target="_blank" rel="noopener">Album</a> 的实现。</p>
<p>下面是 <a href="https://github.com/yanzhenjie/Album" title="Album" target="_blank" rel="noopener">Album</a> 里的一个类<a href="https://github.com/yanzhenjie/Album/blob/588f84224d2e1e5fe08f66928cc2692401faaa00/album/src/main/java/com/yanzhenjie/album/api/BasicCameraWrapper.java" target="_blank" rel="noopener">BasicCameraWrapper</a>，这个类定义了一个泛型，泛型需要继承自 <a href="https://github.com/yanzhenjie/Album/blob/588f84224d2e1e5fe08f66928cc2692401faaa00/album/src/main/java/com/yanzhenjie/album/api/BasicCameraWrapper.java" target="_blank" rel="noopener">BasicCameraWrapper</a>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicCameraWrapper</span>&lt;<span class="title">Returner</span> <span class="keyword">extends</span> <span class="title">BasicCameraWrapper</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">final</span> Context mContext;</span><br><span class="line">    Action&lt;String&gt; mResult;</span><br><span class="line">    Action&lt;String&gt; mCancel;</span><br><span class="line">    <span class="keyword">int</span> mRequestCode;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String mFilePath;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BasicCameraWrapper</span><span class="params">(@NonNull Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mContext = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set the action when result.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Returner <span class="title">onResult</span><span class="params">(Action&lt;String&gt; result)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mResult = result;</span><br><span class="line">        <span class="keyword">return</span> (Returner) <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set the action when canceling.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Returner <span class="title">onCancel</span><span class="params">(Action&lt;String&gt; cancel)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mCancel = cancel;</span><br><span class="line">        <span class="keyword">return</span> (Returner) <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Request tag.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Returner <span class="title">requestCode</span><span class="params">(<span class="keyword">int</span> requestCode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mRequestCode = requestCode;</span><br><span class="line">        <span class="keyword">return</span> (Returner) <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set the image storage path.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Returner <span class="title">filePath</span><span class="params">(@Nullable String filePath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mFilePath = filePath;</span><br><span class="line">        <span class="keyword">return</span> (Returner) <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Start up.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhuliang.io/2018/03/13/summarize-content-provider/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhu Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Now Or Never!!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/13/summarize-content-provider/" itemprop="url">ContentProvide知识点整理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-13T00:00:00+08:00">
                2018-03-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>content<br>{:toc}</li>
</ul>
<h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><p>内容提供者，Android四大组件之一。</p>
<h1 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h1><p><img src="../asserts/content-provider-overview.png" alt=""></p>
<p>应用之间共享数据，其他应用可以通过ContentProvider对数据源进行增删改查。数据源可以：数据库、文件、XML、网络等。</p>
<h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><p>ContentProvider的底层原理：Android的Binder机制（一点都不了解）。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.jianshu.com/p/4ee3fd07da14" target="_blank" rel="noopener">图文详解 Android Binder跨进程通信的原理</a></p>
<h1 id="具体使用"><a href="#具体使用" class="headerlink" title="具体使用"></a>具体使用</h1><h2 id="统一资源标识符（Uri）"><a href="#统一资源标识符（Uri）" class="headerlink" title="统一资源标识符（Uri）"></a>统一资源标识符（Uri）</h2><h3 id="Uri组成"><a href="#Uri组成" class="headerlink" title="Uri组成"></a>Uri组成</h3><p><img src="../asserts/944365-96019a2054eb27cf.png" alt=""></p>
<h2 id="ContentResolver类"><a href="#ContentResolver类" class="headerlink" title="ContentResolver类"></a>ContentResolver类</h2><h3 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h3><p>统一管理不同ContentProvider之间的操作</p>
<p>外部进程通过ContentResolver访问Uri与ContentProvider进行交互</p>
<h2 id="为什么不直接访问ContentProvider？"><a href="#为什么不直接访问ContentProvider？" class="headerlink" title="为什么不直接访问ContentProvider？"></a>为什么不直接访问ContentProvider？</h2><h1 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h1><p><a href="https://www.jianshu.com/p/ea8bc4aaf057" target="_blank" rel="noopener">Android：关于ContentProvider的知识都在这里了！</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhuliang.io/2018/03/11/seek-bar-style/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhu Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Now Or Never!!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/11/seek-bar-style/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-11T00:00:00+08:00">
                2018-03-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最终效果如下：</p>
<p><img src="../images/Jietu20180311-131421.jpg" alt=""></p>
<p><code>SeekBar</code>的xml代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">SeekBar</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:max</span>=<span class="string">"100"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:progress</span>=<span class="string">"20"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:maxHeight</span>=<span class="string">"6dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:progressDrawable</span>=<span class="string">"@drawable/seekbar_bright_progress_drawable"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:thumb</span>=<span class="string">"@drawable/seekbar_thumb"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>seekbar_bright_progress_drawable</code>的代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:shape</span>=<span class="string">"rectangle"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">gradient</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:endColor</span>=<span class="string">"#6cd3ff"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:startColor</span>=<span class="string">"#e70a09"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">size</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:height</span>=<span class="string">"6dp"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">"6dp"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>seekbar_thumb</code>的代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:shape</span>=<span class="string">"oval"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">size</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:width</span>=<span class="string">"@dimen/seekbar_thumb_size"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:height</span>=<span class="string">"@dimen/seekbar_thumb_size"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"@color/seekbar_thumb_color"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意：为了实现SeekBar左右两侧的圆角呈<strong>半圆形</strong>，必须为SeekBar设置<code>android:maxHeight</code>并且为seekbar_bright_progress_drawable的<code>corners</code>设置相同的尺寸，这里设置的是<code>6dp</code>。如果不设置SeekBar的<code>maxHeight</code>，效果如下：</p>
<p><img src="../images/Jietu20180311-132909.jpg" alt=""></p>
<p>参考：<a href="http://light3moon.com/2015/01/26/Android 坑爹大全 —— SeekBar/" target="_blank" rel="noopener">Android 坑爹大全 —— SeekBar</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhuliang.io/2018/03/11/fragment-tab-host-icon-text-tab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhu Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Now Or Never!!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/11/fragment-tab-host-icon-text-tab/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-11T00:00:00+08:00">
                2018-03-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Tab只显示Label"><a href="#Tab只显示Label" class="headerlink" title="Tab只显示Label"></a>Tab只显示Label</h1><p>复制粘贴<code>FragmentTabHost</code>的文档提供了代码片段：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">setContentView(R.layout.fragment_tabs);</span><br><span class="line">mTabHost = (FragmentTabHost)findViewById(android.R.id.tabhost);</span><br><span class="line">mTabHost.setup(<span class="keyword">this</span>, getSupportFragmentManager(), R.id.realtabcontent);</span><br><span class="line"></span><br><span class="line">mTabHost.addTab(mTabHost.newTabSpec(<span class="string">"simple"</span>).setIndicator(<span class="string">"Simple"</span>),</span><br><span class="line">                FragmentStackSupport.CountingFragment.class, <span class="keyword">null</span>);</span><br><span class="line">mTabHost.addTab(mTabHost.newTabSpec(<span class="string">"contacts"</span>).setIndicator(<span class="string">"Contacts"</span>),</span><br><span class="line">                LoaderCursorSupport.CursorLoaderListFragment.class, <span class="keyword">null</span>);</span><br><span class="line">mTabHost.addTab(mTabHost.newTabSpec(<span class="string">"custom"</span>).setIndicator(<span class="string">"Custom"</span>),</span><br><span class="line">                LoaderCustomSupport.AppListFragment.class, <span class="keyword">null</span>);</span><br><span class="line">mTabHost.addTab(mTabHost.newTabSpec(<span class="string">"throttle"</span>).setIndicator(<span class="string">"Throttle"</span>),</span><br><span class="line">                LoaderThrottleSupport.ThrottledLoaderListFragment.class, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
<p>fragment_tabs.xml的代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">"com.lllteam.litra.MainActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">FrameLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/realtabcontent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v4.app.FragmentTabHost</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@android:id/tabhost"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"@color/module_main_tabhost_bg_color"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>运行效果如下：</p>
<p><img src="../images/Screenshot_2018-03-11-13-55-59-415_Litra.png" alt="Screenshot_2018-03-11-13-55-59-415_Litra"></p>
<h1 id="Tab同时显示Label和Icon"><a href="#Tab同时显示Label和Icon" class="headerlink" title="Tab同时显示Label和Icon"></a>Tab同时显示Label和Icon</h1><h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img src="../images/Screenshot_2018-03-11-13-42-35-400_Litra.png" alt="Screenshot_2018-03-11-13-42-35-400_Litra"></p>
<h2 id="错误尝试：setIndicator-CharSequence-label-Drawable-icon"><a href="#错误尝试：setIndicator-CharSequence-label-Drawable-icon" class="headerlink" title="错误尝试：setIndicator(CharSequence label, Drawable icon)"></a>错误尝试：setIndicator(CharSequence label, Drawable icon)</h2><p><code>TabHost.TabSpec</code>提供了<code>setIndicator(CharSequence label, Drawable icon)</code>方法，仅从方法的定义来看是用来同时显示Label和Icon的。但是读了源码后你会发现这不是我们想要的。</p>
<p>分析原因：</p>
<p>调用<code>setIndicator(CharSequence label, Drawable icon)</code>之后，会创建<code>LabelAndIconIndicatorStrategy</code>的实例。创建Tab的View是在<code>LabelAndIconIndicatorStrategy.createIndicatorView()</code>完成的。实例化视图的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">createIndicatorView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    View tabIndicator = inflater.inflate(mTabLayoutId,</span><br><span class="line">                    mTabWidget, <span class="comment">// tab widget is the parent</span></span><br><span class="line">                    <span class="keyword">false</span>); <span class="comment">// no inflate params</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mTabLayoutId</code>赋值是在构造函数<code>public TabHost(Context context, AttributeSet attrs, int defStyleAttr, int defStyleRes)</code>完成的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">TabHost</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr, <span class="keyword">int</span> defStyleRes)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    <span class="keyword">final</span> TypedArray a = context.obtainStyledAttributes(</span><br><span class="line">            attrs, com.android.internal.R.styleable.TabWidget, defStyleAttr, defStyleRes);</span><br><span class="line">    mTabLayoutId = a.getResourceId(R.styleable.TabWidget_tabLayout, <span class="number">0</span>);</span><br><span class="line">    a.recycle();</span><br><span class="line">    <span class="keyword">if</span> (mTabLayoutId == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// In case the tabWidgetStyle does not inherit from Widget.TabWidget and tabLayout is</span></span><br><span class="line">        <span class="comment">// not defined.</span></span><br><span class="line">        mTabLayoutId = R.layout.tab_indicator_holo;</span><br><span class="line">    &#125;</span><br><span class="line">    initTabHost();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里的<code>tabLayout</code>属于Android的内部属性，在写布局文件的时候是无法访问到的，所以<code>mTabLayoutId</code>只能赋值为<code>R.layout.tab_indicator_holo</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"?android:attr/actionBarSize"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">"@android:style/Widget.Holo.Tab"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@android:id/icon"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"center_vertical"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:visibility</span>=<span class="string">"gone"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@android:id/title"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"center_vertical"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">"@android:style/Widget.Holo.TabText"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>结合<code>LabelAndIconIndicatorStrategy.createIndicatorView()</code>以及<code>R.layout.tab_indicator_holo</code>的源码得出结论：不能通过这种方式实现Tab中同时显示Label和Icon。</p>
<h2 id="正确方式：setIndicator-View-view"><a href="#正确方式：setIndicator-View-view" class="headerlink" title="正确方式：setIndicator(View view)"></a>正确方式：setIndicator(View view)</h2><p>使用这个方式，View的样式完全由我们来控制。步骤如下：</p>
<h3 id="定义Indicator实体类"><a href="#定义Indicator实体类" class="headerlink" title="定义Indicator实体类"></a>定义Indicator实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Indicator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String tag;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String label;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> resId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;? extends Fragment&gt; clss;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Indicator <span class="title">create</span><span class="params">(String tag, String label, <span class="keyword">int</span> resId, Class&lt;? extends Fragment&gt; clss)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Indicator(tag, label, resId, clss);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Indicator</span><span class="params">(String tag, String label, <span class="keyword">int</span> resId, Class&lt;? extends Fragment&gt; clss)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tag = tag;</span><br><span class="line">        <span class="keyword">this</span>.label = label;</span><br><span class="line">        <span class="keyword">this</span>.resId = resId;</span><br><span class="line">        <span class="keyword">this</span>.clss = clss;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定义Tab的Label颜色样式"><a href="#定义Tab的Label颜色样式" class="headerlink" title="定义Tab的Label颜色样式"></a>定义Tab的Label颜色样式</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">"@android:color/holo_orange_light"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:state_selected</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">"@android:color/holo_orange_light"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:state_focused</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">"@android:color/darker_gray"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="定义Tab的Icon的Drawable"><a href="#定义Tab的Icon的Drawable" class="headerlink" title="定义Tab的Icon的Drawable"></a>定义Tab的Icon的Drawable</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/module_main_tab_icon_setting_selected"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:state_selected</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/module_main_tab_icon_setting_selected"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:state_focused</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/module_main_tab_icon_setting_normal"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="module-main-tab-indicator布局"><a href="#module-main-tab-indicator布局" class="headerlink" title="module_main_tab_indicator布局"></a>module_main_tab_indicator布局</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">style</span>=<span class="string">"@style/Litra.Tab"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">"?android:attr/actionBarSize"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@android:id/icon"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"24dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"24dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"center_horizontal"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@android:id/title"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"center_horizontal"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">"@color/module_main_tab_label"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="创建FragmentTabHost"><a href="#创建FragmentTabHost" class="headerlink" title="创建FragmentTabHost"></a>创建FragmentTabHost</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建Indicator数组</span></span><br><span class="line"><span class="keyword">private</span> Indicator[] indicators = &#123;</span><br><span class="line">  Indicator.create(<span class="string">"simple"</span>, <span class="string">"Simple"</span>, R.drawable.module_main_tab_icon_light, SimpleFragment.class),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加Tab到FragmentTabHost</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Indicator indicator : indicators) &#123;</span><br><span class="line">        View view = getLayoutInflater().inflate(R.layout.module_main_tab_indicator, <span class="keyword">null</span>);</span><br><span class="line">        ImageView icon = view.findViewById(android.R.id.icon);</span><br><span class="line">        TextView text = view.findViewById(android.R.id.title);</span><br><span class="line">        icon.setImageResource(indicator.resId);</span><br><span class="line">        text.setText(indicator.label);</span><br><span class="line">        mTabHost.addTab(mTabHost.newTabSpec(indicator.tag).setIndicator(view),</span><br><span class="line">                indicator.clss, <span class="keyword">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<p><a href="https://stackoverflow.com/questions/21825037/how-top-set-tab-icon-and-label-in-fragmenttabhost" target="_blank" rel="noopener">How top set tab icon and label in FragmentTabHost</a></p>
<p><a href="https://developer.android.com/studio/write/vector-asset-studio.html?hl=zh-cn" target="_blank" rel="noopener">添加多密度矢量图形</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhuliang.io/2018/03/08/implement-pdf-reader-on-android/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhu Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Now Or Never!!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/08/implement-pdf-reader-on-android/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-08T00:00:00+08:00">
                2018-03-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>Android原生支持PDF并不友好，API 19 开始原生支持创建PDF文件：<code>PdfDocument</code>。API 21 开始支持PDF渲染成：<code>PdfRenderer</code>。如果APP想要支持较低版本的Android系统，只能考虑第三方库了。</p>
<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><ol>
<li>左右翻页</li>
<li>页面支持缩放、平移</li>
<li><del>暂不需要搜索、复制、编辑</del></li>
</ol>
<h1 id="MuPDF"><a href="#MuPDF" class="headerlink" title="MuPDF"></a>MuPDF</h1><p>大多数免费开源库都仅仅提供了PDF预览功能，除了<a href="https://www.MuPDF.com/" target="_blank" rel="noopener">MuPDF</a>以外还调研过  <a href="https://pspdfkit.com/" target="_blank" rel="noopener">pspdfkit</a> ，由于价格原因最终放弃。</p>
<p><img src="https://artifex.com/wp-content/uploads/2017/01/compressive.png" alt=""></p>
<h2 id="MuPDF支持的特性："><a href="#MuPDF支持的特性：" class="headerlink" title="MuPDF支持的特性："></a><a href="http://artifex.com/mupdf-technical-information/#sub-item-3" target="_blank" rel="noopener">MuPDF支持的特性</a>：</h2><h3 id="Viewer-Features"><a href="#Viewer-Features" class="headerlink" title="Viewer Features"></a>Viewer Features</h3><p>MuPDF Viewer provides the following features and functionality:</p>
<ul>
<li>Continuous scroll</li>
<li>Horizontal scroll</li>
<li>Vertical scroll</li>
<li>Two pages at once</li>
<li>Show/hide links</li>
<li>Pinch zoom</li>
<li>Tap-to-zoom</li>
<li>Thumbnails</li>
<li>Multiple documents</li>
<li>Table of contents outline</li>
<li>Go to page</li>
<li>Invert colors</li>
<li>Greyscale</li>
</ul>
<h3 id="Interactive-pdf-features"><a href="#Interactive-pdf-features" class="headerlink" title="Interactive pdf features"></a>Interactive pdf features</h3><h4 id="Annotations"><a href="#Annotations" class="headerlink" title="Annotations"></a>Annotations</h4><p>MuPDF provides a wide range of annotation features to work with and choose from. Full list of annotations:</p>
<ul>
<li>Text</li>
<li>Link</li>
<li>FreeText</li>
<li>Callout style</li>
<li>Line</li>
<li>Square</li>
<li>Circle</li>
<li>Polygon</li>
<li>PolyLine</li>
</ul>
<ul>
<li>Highlight</li>
<li>Underline</li>
<li>Squiggly</li>
<li>Color, Font, etc.</li>
<li>Strikeout</li>
<li>Stamp</li>
<li>Caret</li>
<li>Ink</li>
<li>Popup</li>
</ul>
<ul>
<li>File Attachment</li>
<li>Sound</li>
<li>Widget (forms)</li>
<li>Select</li>
<li>Delete</li>
<li>Undo/Redo</li>
<li>Annotate Programmatically</li>
</ul>
<h3 id="Other-Interactive-Features"><a href="#Other-Interactive-Features" class="headerlink" title="Other Interactive Features"></a>Other Interactive Features</h3><p>MuPDF supports:</p>
<ul>
<li>Form filling</li>
<li>Digital signatures</li>
<li>Hyperlinks</li>
<li>Text reflow</li>
<li>Text search</li>
</ul>
<ul>
<li>Copy text</li>
<li>Page reorder</li>
<li>Page rotate</li>
<li>Add page</li>
<li>Delete page</li>
</ul>
<p>虽然MuPDF支持这么多功能，但是并没有在他们发布的APP（从Google Play）里完全展示出来，而且UI过于丑陋。MuPDF支持的功能其实是核心渲染库支持的功能，渲染库是用标准C语言写的，可以跨平台。</p>
<blockquote>
<h3 id="Platforms-Supported"><a href="#Platforms-Supported" class="headerlink" title="Platforms Supported"></a>Platforms Supported</h3><p>Because it is open source and highly portable, MuPDF is supported on any<br> platform that offers a standard C compiler. This includes the following<br> operating platforms:</p>
<p>iOS</p>
<p>Android</p>
<p>MS Windows</p>
<p>macOS</p>
<p>Linux</p>
<p>UNIX-like systems (e.g., OpenBSD, FreeBSD)</p>
</blockquote>
<h2 id="Android应用MuPDF"><a href="#Android应用MuPDF" class="headerlink" title="Android应用MuPDF"></a>Android应用MuPDF</h2><p><a href="https://github.com/ArtifexSoftware/mupdf-android-viewer-mini" target="_blank" rel="noopener">mupdf-android-viewer-mini</a> 是比较新的Example版本，通过读源码学习MuPDF的使用。</p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><p><code>com.artifex.mupdf:fitz</code>是MuPDF对jni的封装。如果想要完全重写PDF应用可以引用这个依赖。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.artifex.mupdf:fitz:1.12.0'</span></span><br></pre></td></tr></table></figure>
<p><code>com.artifex.mupdf:mini</code> 这个库除了引用<code>com.artifex.mupdf:fitz</code>之外，还提供了简单的PDF预览页面：<code>DocumentActivity</code>。UI过于简陋，可以读源码了解MuPDF的使用方法。以下章节就是通过读<code>DocumentActivity</code>学习到的使用MuPDF的流程。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.artifex.mupdf:mini:1.12.0'</span></span><br></pre></td></tr></table></figure>
<h3 id="获取文件"><a href="#获取文件" class="headerlink" title="获取文件"></a>获取文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Uri uri = getIntent().getData();</span><br><span class="line">String path;</span><br><span class="line"><span class="keyword">byte</span>[] buffer;</span><br><span class="line"><span class="keyword">if</span> (uri.getScheme().equals(<span class="string">"file"</span>)) &#123;</span><br><span class="line">  <span class="comment">// 获取文档的绝对路径</span></span><br><span class="line">   path = uri.getPath();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    InputStream stm = getContentResolver().openInputStream(uri);</span><br><span class="line">    ByteArrayOutputStream out = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">    <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">16384</span>];</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">while</span> ((n = stm.read(buf)) != -<span class="number">1</span>)</span><br><span class="line">      out.write(buf, <span class="number">0</span>, n);</span><br><span class="line">    out.flush();</span><br><span class="line">    <span class="comment">// 获取文档的字节数组</span></span><br><span class="line">    buffer = out.toByteArray();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException x) &#123;</span><br><span class="line">    Log.e(APP, x.toString());</span><br><span class="line">    Toast.makeText(<span class="keyword">this</span>, x.getMessage(), Toast.LENGTH_SHORT).show();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="打开PDF文档"><a href="#打开PDF文档" class="headerlink" title="打开PDF文档"></a>打开PDF文档</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Document.java</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> filename 文件的绝对路径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Document <span class="title">openDocument</span><span class="params">(String filename)</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> buffer 文件的字节数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> magic  文件的mimeType</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Document <span class="title">openDocument</span><span class="params">(<span class="keyword">byte</span>[] buffer, String magic)</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>获取到PDF文档实例<code>Document</code>后，需要先调用<code>Document.needsPassword()</code>方法判断是否设置了密码，如果设置了密码，需要用户输入密码，然后调用<code>Document.authenticatePassword(String)</code>输入密码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Document.java</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * PDF文档是否设置了密码 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">needsPassword</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 输入密码</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 密码正确返回true，密码错误返回false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">authenticatePassword</span><span class="params">(String var1)</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="加载PDF文档"><a href="#加载PDF文档" class="headerlink" title="加载PDF文档"></a>加载PDF文档</h3><p>参考<code>DocumentActivity.loadDocument()</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Document.java</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取文档的元数据</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> META_INFO_AUTHOR 获取文档的作者</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> META_INFO_TITLE  获取文档的标题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">getMetaData</span><span class="params">(String var1)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否进入重新格式化模式(可能是用html的方式渲染文档)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">isReflowable</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="加载PDF文档的页面"><a href="#加载PDF文档的页面" class="headerlink" title="加载PDF文档的页面"></a>加载PDF文档的页面</h3><p>参考<code>DocumentActivity.loadPage()</code>。</p>
<p>获取PDF文档页面<code>Page</code>实例的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Document.java</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据页码获取PDF文档页面</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> var1 页码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> Page <span class="title">loadPage</span><span class="params">(<span class="keyword">int</span> var1)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AndroidDrawDevice.java</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">drawPageFit</span><span class="params">(Page page, <span class="keyword">int</span> fitW, <span class="keyword">int</span> fitH)</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">drawPage</span><span class="params">(Page page, <span class="keyword">float</span> dpi, <span class="keyword">int</span> rotate)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">drawPage</span><span class="params">(Page page, <span class="keyword">float</span> dpi)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">drawPageFit</span><span class="params">(Page page, <span class="keyword">int</span> fitW, <span class="keyword">int</span> fitH)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">drawPageFitWidth</span><span class="params">(Page page, <span class="keyword">int</span> fitW)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将 Page 转成 Bitmap 的核心方法，上面的方法最后都是调用的这个方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">drawPage</span><span class="params">(Page page, Matrix ctm)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Page.java</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取页面中的链接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> Link[] getLinks();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取页面中搜索结果的位置 </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> var1 搜索的关键字</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> Rect[] search(String var1);</span><br></pre></td></tr></table></figure>
<h3 id="加载PDF文档的大纲"><a href="#加载PDF文档的大纲" class="headerlink" title="加载PDF文档的大纲"></a>加载PDF文档的大纲</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Document.java</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取文档的大纲</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> Outline[] loadOutline();</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhuliang.io/2018/02/28/summarize-product-of-my-company/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhu Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Now Or Never!!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/28/summarize-product-of-my-company/" itemprop="url">公司产品知识点整理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-28T00:00:00+08:00">
                2018-02-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>目录<br>{:toc}</li>
</ul>
<h1 id="签名-APK-相关问题"><a href="#签名-APK-相关问题" class="headerlink" title="签名 APK 相关问题"></a>签名 APK 相关问题</h1><h2 id="用Android-Studio签名的APK，部分机型安装不上"><a href="#用Android-Studio签名的APK，部分机型安装不上" class="headerlink" title="用Android Studio签名的APK，部分机型安装不上"></a>用Android Studio签名的APK，部分机型安装不上</h2><p>签名APK一直使用Android Studio的<strong>generate Signed Apk…</strong>，打包给同事测试的时候，同事反应安装不上，提示“<strong>应用未安装</strong>”。在终端用 adb 命令 :</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb install whatever.apk</span><br><span class="line">pkg: /data/<span class="built_in">local</span>/tmp/whatever.apk</span><br><span class="line">Failure [INSTALL_PARSE_FAILED_NO_CERTIFICATES]</span><br></pre></td></tr></table></figure>
<p><a href="https://stackoverflow.com/questions/2914105/what-is-install-parse-failed-no-certificates-error" target="_blank" rel="noopener">What is INSTALL_PARSE_FAILED_NO_CERTIFICATES error?</a> 解决了这个问题：</p>
<p><img src="https://i.stack.imgur.com/Dijv8.png" alt=""></p>
<p>我在签名的时候，没有勾选上”<strong>V1(Jar Signature)</strong>“。Android官方<a href="https://source.android.com/security/apksigning/" target="_blank" rel="noopener">应用签名</a>介绍了V1和V2的区别：</p>
<blockquote>
<p>Android 支持两种应用签名方案，一种是基于 JAR 签名的方案（v1 方案），另一种是 Android Nougat (Android 7.0) 中引入的 <a href="https://source.android.com/security/apksigning/v2.html" target="_blank" rel="noopener">APK 签名方案 v2（v2 方案）</a>。</p>
<p>为了最大限度地提高兼容性，应同时采用 v1 和 v2 这两种方案对应用进行签名。与只通过 v1 方案签名的应用相比，通过 v2 方案签名的应用能够更快速地安装到 Android Nougat 及更高版本的设备上。更低版本的 Android 平台会忽略 v2 签名，这就需要应用包含 v1 签名。</p>
</blockquote>
<h1 id="DP与PX转换"><a href="#DP与PX转换" class="headerlink" title="DP与PX转换"></a>DP与PX转换</h1><h2 id="DP转PX"><a href="#DP转PX" class="headerlink" title="DP转PX"></a>DP转PX</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int dpToPx(Context context, int dps) &#123;</span><br><span class="line">    return Math.round(context.getResources().getDisplayMetrics().density * dps);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="日志留存"><a href="#日志留存" class="headerlink" title="日志留存"></a>日志留存</h1><h2 id="步骤一：引入依赖"><a href="#步骤一：引入依赖" class="headerlink" title="步骤一：引入依赖"></a>步骤一：引入依赖</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// build.gradle</span></span><br><span class="line">compile <span class="string">'com.jakewharton.timber:timber:4.6.0'</span></span><br><span class="line">compile <span class="string">'log4j:log4j:1.2.17'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入 android-logging-log4j-1.0.3.jar</span></span><br></pre></td></tr></table></figure>
<h2 id="步骤二：初始化timber"><a href="#步骤二：初始化timber" class="headerlink" title="步骤二：初始化timber"></a>步骤二：初始化timber</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Application</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 收集日志信息</span></span><br><span class="line">  <span class="keyword">if</span> (BuildConfig.DEBUG) &#123;</span><br><span class="line">    Timber.plant(<span class="keyword">new</span> Timber.DebugTree(), LogTrackerTree.getInstance());</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Timber.plant(LogTrackerTree.getInstance());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LogTrackerTree</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogTrackerTree</span> <span class="keyword">extends</span> <span class="title">Timber</span>.<span class="title">Tree</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LogTrackerTree sInstance;</span><br><span class="line">    <span class="keyword">private</span> LogConfigurator mLogConfigurator = <span class="keyword">new</span> LogConfigurator();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LogTrackerTree <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (sInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LogTrackerTree.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (sInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    sInstance = <span class="keyword">new</span> LogTrackerTree();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sInstance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LogTrackerTree</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        File logFile = <span class="keyword">new</span> File(DirectoryUtils.getNutstoreLogDir(), <span class="string">"whatever.log"</span>);</span><br><span class="line">        String filePattern = <span class="string">"%d - [%c] - %p : %m%n"</span>;</span><br><span class="line">        <span class="keyword">int</span> maxBackupSize = <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">long</span> maxFileSize = <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">        configure(logFile.getAbsolutePath(), filePattern, maxBackupSize, maxFileSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(String fileName, String filePattern, <span class="keyword">int</span> maxBackupSize, <span class="keyword">long</span> maxFileSize)</span> </span>&#123;</span><br><span class="line">        mLogConfigurator.setFileName(fileName);</span><br><span class="line">        mLogConfigurator.setMaxFileSize(maxFileSize);</span><br><span class="line">        mLogConfigurator.setFilePattern(filePattern);</span><br><span class="line">        mLogConfigurator.setMaxBackupSize(maxBackupSize);</span><br><span class="line">        mLogConfigurator.setUseLogCatAppender(<span class="keyword">true</span>);</span><br><span class="line">        mLogConfigurator.configure();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(<span class="keyword">int</span> priority, String tag, @NonNull String message, Throwable t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (priority) &#123;</span><br><span class="line">            <span class="keyword">case</span> Log.VERBOSE:</span><br><span class="line">                <span class="comment">// do nothing</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> Log.DEBUG:</span><br><span class="line">                Logger.getLogger(tag).debug(msg, t);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> Log.INFO:</span><br><span class="line">                Logger.getLogger(tag).info(msg, t);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> Log.WARN:</span><br><span class="line">                Logger.getLogger(tag).warn(msg, t);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> Log.ERROR:</span><br><span class="line">                Logger.getLogger(tag).warn(msg, t);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> Log.ASSERT:</span><br><span class="line">                Logger.getLogger(tag).error(msg, t);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Invalid priority: "</span> + priority);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="步骤三：打印log"><a href="#步骤三：打印log" class="headerlink" title="步骤三：打印log"></a>步骤三：打印log</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Timber.tag(tag).d(msg);</span><br><span class="line">Timber.tag(tag).v(msg);</span><br><span class="line">Timber.tag(tag).e(msg);</span><br></pre></td></tr></table></figure>
<h1 id="UI-相关"><a href="#UI-相关" class="headerlink" title="UI 相关"></a>UI 相关</h1><h2 id="PopupWindow相关"><a href="#PopupWindow相关" class="headerlink" title="PopupWindow相关"></a>PopupWindow相关</h2><h3 id="仿微信弹出相册选择页面"><a href="#仿微信弹出相册选择页面" class="headerlink" title="仿微信弹出相册选择页面"></a>仿微信弹出相册选择页面</h3><p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1foxdf5336fg306r0c04qq.gif" alt=""></p>
<p>Android提供了<code>ListPopupWindow</code>，内部封装了PopupWindow、ListView，代码如下：</p>
<p><strong>布局文件</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">tools:context</span>=<span class="string">".v2.ui.photoselect.PhotoSelectActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">&lt;!--选择相册后显示相册下所有的图片--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/recycler_view"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">&lt;!--锚点--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/popup_anchor"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"1dp"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/bottomBar"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"@dimen/spacing_56dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"@color/colorAccent"</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">      	<span class="comment">&lt;!--点击按钮弹出相册选择页面--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/button_photo_select_album_picker"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_centerVertical</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"图片"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>弹出相册选择代码</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">showAlbumPicker</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (view == <span class="literal">null</span> || context == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> recyclerView = view!!.findViewById&lt;RecyclerView&gt;(R.id.recycler_view)</span><br><span class="line">    <span class="keyword">val</span> popupWindow = ListPopupWindow(context!!)</span><br><span class="line">  	<span class="comment">// 为 popupWindow 设置固定的宽高</span></span><br><span class="line">    popupWindow.width = recyclerView.width</span><br><span class="line">    popupWindow.height = recyclerView.height</span><br><span class="line">    popupWindow.setBackgroundDrawable(ColorDrawable(Color.WHITE))</span><br><span class="line">    <span class="comment">// 为 popupWindow设置锚点</span></span><br><span class="line">    popupWindow.anchorView = view!!.findViewById(R.id.popup_anchor)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// popupWindow 设置为模态弹窗</span></span><br><span class="line">  	popupWindow.isModal = <span class="literal">true</span></span><br><span class="line">    popupWindow.setAdapter(mAdapter)</span><br><span class="line">    popupWindow.setOnItemClickListener &#123; _, _, position, _ -&gt;</span><br><span class="line">        <span class="keyword">if</span> (mAdapter != <span class="literal">null</span>) &#123;</span><br><span class="line">            mAdapter?.setCheckedPosition(position)</span><br><span class="line">            mPresenter.loadPhotos(mAdapter!!.getItem(position))</span><br><span class="line">        &#125;</span><br><span class="line">        popupWindow.dismiss()</span><br><span class="line">    &#125;</span><br><span class="line">    popupWindow.show()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="https://baike.baidu.com/item/%E6%A8%A1%E6%80%81%E5%AF%B9%E8%AF%9D%E6%A1%86/6449704?fr=aladdin" target="_blank" rel="noopener">【百度百科】</a>模态对话框（Modal Dialogue Box，又叫做<a href="https://baike.baidu.com/item/%E6%A8%A1%E5%BC%8F%E5%AF%B9%E8%AF%9D%E6%A1%86" target="_blank" rel="noopener">模式对话框</a>），是指在用户想要对对话框以外的应用程序进行操作时，必须首先对该对话框进行响应。如单击【确定】或【取消】按钮等将该对话框关闭。</p>
</blockquote>
<p>参考：<a href="http://www.jcodecraeer.com/a/opensource/2015/0415/2726.html" target="_blank" rel="noopener">仿微信实现多图选择。支持单选和多选两种模式 </a></p>
<h2 id="BottomSheetDialog相关"><a href="#BottomSheetDialog相关" class="headerlink" title="BottomSheetDialog相关"></a>BottomSheetDialog相关</h2><h3 id="如何动态设置BottomSheetDialog的高度"><a href="#如何动态设置BottomSheetDialog的高度" class="headerlink" title="如何动态设置BottomSheetDialog的高度"></a>如何动态设置BottomSheetDialog的高度</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 让对话框中的内容全部展示，而不是仅仅显示一部分</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HackyBottomSheetDialog</span></span>(context: Context, theme: <span class="built_in">Int</span>) : BottomSheetDialog(context, theme) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setContentView</span><span class="params">(layoutResId: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.setContentView(layoutResId)</span><br><span class="line">        hackContentView()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setContentView</span><span class="params">(view: <span class="type">View</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.setContentView(view)</span><br><span class="line">        hackContentView()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">hackContentView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> parent = findViewById&lt;View&gt;(R.id.design_bottom_sheet)!!</span><br><span class="line">        <span class="keyword">val</span> behavior = BottomSheetBehavior.from(parent)</span><br><span class="line">        parent.measure(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        behavior.peekHeight = parent.measuredHeight</span><br><span class="line">        <span class="keyword">val</span> params = parent.layoutParams <span class="keyword">as</span> CoordinatorLayout.LayoutParams</span><br><span class="line">        params.gravity = Gravity.TOP or Gravity.CENTER_HORIZONTAL</span><br><span class="line">        parent.layoutParams = params</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="解决横屏状态下由于内容过长导致在BottomSheetDialog不能完全展示"><a href="#解决横屏状态下由于内容过长导致在BottomSheetDialog不能完全展示" class="headerlink" title="解决横屏状态下由于内容过长导致在BottomSheetDialog不能完全展示"></a>解决横屏状态下由于内容过长导致在BottomSheetDialog不能完全展示</h3><p>用 <code>android.support.v4.widget.NestedScrollView</code>包裹<strong>内容视图</strong>，注意不能用<code>ScrollView</code></p>
<h3 id="LinearLayoutCompat添加分割线divider"><a href="#LinearLayoutCompat添加分割线divider" class="headerlink" title="LinearLayoutCompat添加分割线divider"></a>LinearLayoutCompat添加分割线divider</h3><h4 id="创建分割线文件"><a href="#创建分割线文件" class="headerlink" title="创建分割线文件"></a>创建分割线文件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:shape</span>=<span class="string">"line"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"@android:color/white"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 分割线的高度 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">size</span> <span class="attr">android:height</span>=<span class="string">"2dip"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="设置分割线"><a href="#设置分割线" class="headerlink" title="设置分割线"></a>设置分割线</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.v7.widget.LinearLayoutCompat</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:divider</span>=<span class="string">"@drawable/divider"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:showDividers</span>=<span class="string">"middle"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"Item 1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">"#fff"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"Item 2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">"#fff"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.v7.widget.LinearLayoutCompat</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意：</p>
<p><code>LinearLayoutCompat</code>的<code>app:showDividers=&quot;middle|end|none|beginning&quot;</code> 用来设置分割线显示的位置</p>
<h1 id="Intent-ACTION相关"><a href="#Intent-ACTION相关" class="headerlink" title="Intent.ACTION相关"></a>Intent.ACTION相关</h1><h2 id="注册Intent-ACTION-VIEW支持所有类型文件的Activity"><a href="#注册Intent-ACTION-VIEW支持所有类型文件的Activity" class="headerlink" title="注册Intent.ACTION_VIEW支持所有类型文件的Activity"></a>注册Intent.ACTION_VIEW支持所有类型文件的Activity</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:name</span>=<span class="string">".ActionViewer"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:configChanges</span>=<span class="string">"orientation"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:exported</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:label</span>=<span class="string">"ActionViewer"</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.BROWSABLE"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"file"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:mimeType</span>=<span class="string">"*/*"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.BROWSABLE"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"file"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!--以下代码解决在“邮箱大师”不可见该Activity的bug--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.BROWSABLE"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:mimeType</span>=<span class="string">"*/*"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong> 这里的<code>intent-filter</code>并不是写重了，如果只写第一个，有些APP不会显示这个Activity，<strong>比如TIM的“用其他应用打开*.ai、*.psd文件”</strong>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhuliang.io/2018/02/28/summarize-gradle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhu Liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Now Or Never!!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/28/summarize-gradle/" itemprop="url">Gradle 3.+ 知识点整理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-28T00:00:00+08:00">
                2018-02-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Gradle/" itemprop="url" rel="index">
                    <span itemprop="name">Gradle</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="使用新依赖项配置"><a href="#使用新依赖项配置" class="headerlink" title="使用新依赖项配置"></a>使用新依赖项配置</h1><table>
<thead>
<tr>
<th>新配置</th>
<th>已弃用配置</th>
<th>行为</th>
</tr>
</thead>
<tbody>
<tr>
<td>implementation</td>
<td>compile</td>
<td>依赖项在编译时对模块可用，并且仅在运行时对模块的消费者可用。 对于大型多项目构建，使用 implementation 而不是 api/compile 可以显著缩短构建时间，因为它可以减少构建系统需要重新编译的项目量。 大多数应用和测试模块都应使用此配置。</td>
</tr>
<tr>
<td>api</td>
<td>compile</td>
<td>依赖项在编译时对模块可用，并且在编译时和运行时还对模块的消费者可用。 此配置的行为类似于 compile（现在已弃用），一般情况下，您应当仅在库模块中使用它。 应用模块应使用 implementation，除非您想要将其 API 公开给单独的测试模块。</td>
</tr>
<tr>
<td>compileOnly</td>
<td>provided</td>
<td>依赖项仅在编译时对模块可用，并且在编译或运行时对其消费者不可用。 此配置的行为类似于 provided（现在已弃用）。</td>
</tr>
<tr>
<td>runtimeOnly</td>
<td>apk</td>
<td>依赖项仅在运行时对模块及其消费者可用。 此配置的行为类似于 apk（现在已弃用）。</td>
</tr>
</tbody>
</table>
<p>参考：<a href="https://developer.android.com/studio/build/gradle-plugin-3-0-0-migration.html" target="_blank" rel="noopener">迁移到 Android Plugin for Gradle 3.0.0</a></p>
<h1 id="API-变更"><a href="#API-变更" class="headerlink" title="API 变更"></a>API 变更</h1><h2 id="变体输出"><a href="#变体输出" class="headerlink" title="变体输出"></a>变体输出</h2><p>使用 Variant API 操作变体输出在新插件中已不再受支持。 不过，这种方式仍然适用于简单任务，例如在构建时更改 APK 名称，如下所示：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// If you use each() to iterate through the variant objects,</span></span><br><span class="line"><span class="comment">// you need to start using all(). That's because each() iterates</span></span><br><span class="line"><span class="comment">// through only the objects that already exist during configuration time—</span></span><br><span class="line"><span class="comment">// but those object don't exist at configuration time with the new model.</span></span><br><span class="line"><span class="comment">// However, all() adapts to the new model by picking up object as they are</span></span><br><span class="line"><span class="comment">// added during execution.</span></span><br><span class="line">android.applicationVariants.all &#123; variant -&gt;</span><br><span class="line">    variant.outputs.all &#123;</span><br><span class="line">        outputFileName = <span class="string">"$&#123;variant.name&#125;-$&#123;variant.versionName&#125;.apk"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考：<a href="https://developer.android.com/studio/build/gradle-plugin-3-0-0-migration.html" target="_blank" rel="noopener">迁移到 Android Plugin for Gradle 3.0.0</a></p>
<h1 id="配置构建变体"><a href="#配置构建变体" class="headerlink" title="配置构建变体"></a>配置构建变体</h1><p>参考：<a href="https://developer.android.com/studio/build/build-variants.html?hl=zh-cn" target="_blank" rel="noopener">https://developer.android.com/studio/build/build-variants.html?hl=zh-cn</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Zhu Liang" />
          <p class="site-author-name" itemprop="name">Zhu Liang</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhu Liang</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
